language: java
jdk: oraclejdk8
sudo: required
script:
- "./mvnw clean install -B"
- "./mvnw clean package sonar:sonar"
services:
- docker
env:
  global:
  - secure: M3zN4Znn55nxs6aFhTfliFZLAVO7YolqUCCYM4fcvZLmzVfsisy4kWDXp6KwcW1e8ZDRtw0Mqy918GGkRzG5I/U523byXRhMxO7XyXq13+II4HsFfvOHXQ+uC2miVMZCMuwskrTCnHlHrbUpi8Vz1kPE9WiS7672i9GRtZqqRwcqY3Z2YCewZsQqX+zmzlgByLNdw5hqtXwfmZMXQnULLHkmxlwE9vV5hm8C3NP/FhgJvIZjN5H2uhTYteZTuSFdpBge2tSUO6Zw5zkHxXZfRURNj0TGItcPE+dd3pvFuNaaIjRpCns4PuSMTxmgAP4/COAnuZYuYWBcmdoDMCOrHdbxVzGxEH+4ZPCYLUTngTyjkxYgih8FJ+VbGl1cI13MfVYlkXcTQw2yuEpdEiReMS+TM1s/0YeN3Q9TsqI/dWY+nCN383cIKnSe4agjw9ZCODS70AN2asoTOfKEDvyT1t4suLocmpNsx0HTzLJsyEGcduYinxSpzm2+2mBzHxzrW+ETjoYVR/jh+Qsqy4xupFPXqnE6qpUm61NWTSVkct0GEvAFpRcZy23r6mKIv56KnmHOln3Fz6t2T0m+24XCfR39X1O7VCfZ/wdTFI2fNzhK5W0No2IYy9hWhpvdT+dxoiDvhcFBW/uYUVpP0JeTddLhdSqRkXnlp5BUUBfJbGI=
  - secure: DRZdIT+hQtCOgIfB/UmD0qsNXAHtuw4nLM/3ANyapmw0Dos+o4/C2uGuqarBmAXoz3yz0ggtHabHbgdEoS3tXNMoR9eyBuear6wfOWaGyTIPPphVyF9Ep3s5DMXTFHg3utVXMqxzonAkfzqpdC/FbkvuCReYF1pR2MEDsVcGUdpHGSnTyspnNF8rhYf8DMWMHaahc0jlkxaX8JxrRNELOwvTRTbR7S18MqQkKiLdwSc5llxSN73c1GPNhc5WqwcPAXuQxfyyJZ7nv07oT/UHDsqt5Cymz0Uh5QzsdyUBQLsp+B9cxVJQSVAqwSam3jeoRME1p5HZQQMm0QK8cibTuE3Wpoa9cdWCCeSeZ0N8e53uqxRcWtpnkBhZdopb2a5Nj1kJil3aDdVAX2tAK5GLS03d1y1O1QcK7iXk/0Tp2tjPDi2L+gqf3D7oEB1obnd/00i5p11VLUjna5F1GdljW/RLblHUazTlE3+xbjma2gnFoP1pxJ0/Y+wmp3PlPS9S3tffkSHbqDMngeVbpQTEuog/uW3GEMuDg83inRiz7lVy+rcviwt2Xhd5Qj1WjYuvQv1k/rI0gRZ5ifnTizvGfjR1bXQ6vlsRKBKDK5W8lBCYx/kVewgJaD5SfeS1IN0merJbedL3FNTSmmv5NGgnGOnSaWVmOFooJ7AKn+QrlFA=
  - secure: nRUfET8LpNlA3zhUG40lC7IC6hOL/LOVv7Yno2rKnEZoTmDZXfcNKYORvU2e8IrVMYZSztwupRfAXDiQw3J2ES1XBRmvNpVpCkX6m9Gy4NPdNBBf0Y+NWZGgc69x3/b7EYu4L9dTZzUNKJAbzvD5xqWH72rOi/xyEZxNYlsmRzuI9C4BDiIIEgFeiJW1tRqZ5E+gaWIwKzwYD5I4B96AveP+veFkXHkA7OSqnrzjRu9icQDzDvOc0yEu+m31PbpDav3fdXVpObYfCppFFyzZW7skwnxp8Ij9GJI72zVVyr2qmsNQSlBJ9URSBkz/6j59K9DCoFF7+2Jx+K4DH217DBlLlJZj7XY12n2meKhpPio7H5KeB23/3OLZnRfxAf1mw3Bspdz1EGcNqb11fHywsfCbeLqq98CTYjDuSN5IOOYl6N8hLjejxBiiSj1mMZ66dPFX1jsZ3fIAB5GXdxQoZzDiRKevgjIOf0YYOy6+E4aWXkgX6fVu9bduW/vZ3QbTyMJWBb3tcJKs1gB35nVaq01+o5HDdJqQPMJB+yW55aREWDSxXnapYERxro7Pj+VvFWx0oliURl85J9HYmyvSYa7CmAu6qyi8PZe0V+Jp+/ZCR/Yw5Sh14YrHylmFfKPTCxH7a8FndE6JP2DAxl/46FlDJcaiN5cwslEBHr/4MD4=
addons:
  sonarcloud:
    organization: mr-cell-github
    token:
      secure: "$SONAR_TOKEN"
after_success:
- docker login -u $DOCKER_USER -p $DOCKER_PASS
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH;
  fi`
- export IMAGE_NAME=mrcell/spring-demo
- docker build -t $IMAGE_NAME:$COMMIT .
- docker tag $IMAGE_NAME:$COMMIT $IMAGE_NAME:$TAG
- docker push $IMAGE_NAME
